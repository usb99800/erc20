<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERC20 Address Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.1/ethers.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        textarea, input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        #results {
            white-space: pre-wrap;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ERC20 Address Analyzer</h1>
        
        <label for="rpcUrl">RPC URL:</label>
        <input type="text" id="rpcUrl" value="wss://ethereum-rpc.publicnode.com">
        
        <label for="input">Input String:</label>
        <textarea id="input" rows="5"></textarea>
        
        <button onclick="extractAddresses()">Step 1: Extract Addresses</button>
        <button onclick="calculateBalances()">Step 2: Calculate Balances</button>
        
        <label for="tokenAddress">ERC20 Token Address:</label>
        <input type="text" id="tokenAddress">
        
        <button onclick="analyzeToken()">Analyze Token</button>
        
        <div id="results"></div>
    </div>

    <script>
        let provider;
        let extractedAddresses = [];

        function initProvider() {
            provider = new ethers.providers.WebSocketProvider(document.getElementById('rpcUrl').value);
        }

		function extractAddresses() {
			const input = document.getElementById('input').value;
			const addressRegex = /0x[a-fA-F0-9]{40}/g;
			const addresses = input.match(addressRegex) || [];

			const uniqueAddressMap = new Map();
			addresses.forEach(address => {
				const lowerCaseAddress = address.toLowerCase();
				if (!uniqueAddressMap.has(lowerCaseAddress)) {
					uniqueAddressMap.set(lowerCaseAddress, address);
				}
			});

			extractedAddresses = Array.from(uniqueAddressMap.values()).sort((a, b) => 
				a.toLowerCase().localeCompare(b.toLowerCase())
			);

			let result = "Extracted Addresses:\n";
			extractedAddresses.forEach((address, index) => {
				result += `${index + 1}. ${address}\n`;
			});

			document.getElementById('results').textContent = result;
		}

        async function calculateBalances() {
            if (extractedAddresses.length === 0) {
                alert("Please extract addresses first.");
                return;
            }

            initProvider();
            const wethAddress = '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2';
            const wethAbi = [{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"}];
            const wethContract = new ethers.Contract(wethAddress, wethAbi, provider);

            let result = "Balances:\n";
            let totalEth = ethers.BigNumber.from(0);
            let totalWeth = ethers.BigNumber.from(0);

            for (let i = 0; i < extractedAddresses.length; i++) {
                const address = extractedAddresses[i];
                const ethBalance = await provider.getBalance(address);
                const wethBalance = await wethContract.balanceOf(address);

                totalEth = totalEth.add(ethBalance);
                totalWeth = totalWeth.add(wethBalance);

                result += `${i + 1}. ${address}\n`;
                result += `   ETH: ${ethers.utils.formatEther(ethBalance)} ETH\n`;
                result += `   WETH: ${ethers.utils.formatEther(wethBalance)} WETH\n\n`;
            }

            result += `Total ETH: ${ethers.utils.formatEther(totalEth)} ETH\n`;
            result += `Total WETH: ${ethers.utils.formatEther(totalWeth)} WETH\n`;

            document.getElementById('results').textContent = result;
        }

        async function analyzeToken() {
            initProvider();
            const tokenAddress = document.getElementById('tokenAddress').value;
            const tokenAbi = [{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"type":"function"}];
            const tokenContract = new ethers.Contract(tokenAddress, tokenAbi, provider);

            const decimals = await tokenContract.decimals();
            const symbol = await tokenContract.symbol();

            let result = `Token Analysis (${symbol}):\n`;

            for (let i = 0; i < extractedAddresses.length; i++) {
                const address = extractedAddresses[i];
                const balance = await tokenContract.balanceOf(address);

                if (balance.gt(0)) {
                    result += `${address}: ${ethers.utils.formatUnits(balance, decimals)} ${symbol}\n`;
                }
            }

            document.getElementById('results').textContent = result;
        }
    </script>
</body>
</html>
